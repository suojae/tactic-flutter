#!/bin/sh
echo "ğŸ” Running Dart format and analyze only on staged files..."

# ì»¤ë°‹í•˜ë ¤ëŠ” íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
STAGED_FILES=$(git diff --cached --name-only --diff-filter=d | grep '\.dart$')

# ì»¤ë°‹í•  Dart íŒŒì¼ì´ ì—†ìœ¼ë©´ ì¢…ë£Œ
if [ -z "$STAGED_FILES" ]; then
  echo "âœ… No Dart files to check."
  exit 0
fi

# ì»¤ë°‹í•  íŒŒì¼ì— ëŒ€í•´ dart format ì‹¤í–‰
echo "ğŸ”§ Formatting staged Dart files..."
echo "$STAGED_FILES" | xargs dart format -o write

# ì»¤ë°‹í•  íŒŒì¼ì— ëŒ€í•´ dart analyze ì‹¤í–‰
echo "ğŸ” Analyzing staged Dart files..."
echo "$STAGED_FILES" | xargs dart analyze

# ë§Œì•½ `dart analyze`ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì»¤ë°‹ ì°¨ë‹¨
if [ $? -ne 0 ]; then
  echo "âŒ Commit rejected: Fix issues before committing!"
  exit 1
fi

echo "âœ… All checks passed! Proceeding with commit."
